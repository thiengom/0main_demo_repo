const cds = require('../../cds')
const templatePathSerializer = (tKey, keyNames, row, elements, draftKeys) => {
  const keyValuePairs = keyNames
    .filter(key => {
      if (cds.env.features.lean_draft && key === 'IsActiveEntity') return false
      return true
    })
    .map(key => {
      let quote

      switch (elements[key].type) {
        case 'cds.String':
          quote = "'"
          break

        default:
          quote = ''
          break
      }

      const keyValue = row[key] ?? draftKeys?.[key]
      return `${key}=${quote}${keyValue}${quote}`
    })

  const keyValuePairsSerialized = keyValuePairs.join(',')
  return `${tKey}(${keyValuePairsSerialized})`
}

module.exports = templatePathSerializer
