const auth      = exports.auth      = require('../../auth')
const context   = exports.context   = require('./cds-context')
const ctx_auth  = exports.ctx_auth  = require('./ctx-auth')
const ctx_model = exports.ctx_model = require('./ctx-model')
const errors    = exports.errors    = require('./errors')
const trace     = exports.trace     = require('./trace')

// middlewares running before protocol adapters
exports.before = [
  context(),    // provides cds.context
  trace(),      // provides detailed trace logs when DEBUG=trace
  auth(),       // provides req.user & tenant
  ctx_auth(),   // propagates auth results to cds.context
  ctx_model(),  // fills in cds.context.model, in case of extensibility
]

// middlewares running after protocol adapters -> usually error middlewares
exports.after = [
  errors(),
]
